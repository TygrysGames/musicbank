<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MusicBank Embed</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Archivo%20Black:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://kit.fontawesome.com/ff94d9f1bd.js" crossorigin="anonymous"></script>
</head>
<body>
    <div class="container">
        <div class="music-player">
            <h2>MusicBank</h2>
            <h1 id="song-name">Song Name</h1>
            <p id="song-author">Song Author</p>
            <audio id="audio">
                <source id="audio-source" src="" type="audio/mpeg">
            </audio>
            <input id="progress" type="range" value="0" step="0.1">
            
            <div class="controls">
                <div onclick="skip(-10)"><i class="fa-solid fa-backward"></i></div>
                <div onclick="playPause()"><i class="fa-solid fa-play" id="ctrlIcon"></i></div>
                <div onclick="skip(10)"><i class="fa-solid fa-forward"></i></div>
                <div onclick="shuffleSong()"><i class="fa-solid fa-shuffle"></i></div> <!-- Shuffle Button -->
            </div>
            
        </div>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const audioLink = urlParams.get('link');
        const audioName = urlParams.get('name');
        const audioAuthor = urlParams.get('author');

        document.getElementById('audio-source').src = audioLink;
        document.getElementById('song-name').innerHTML = audioName;
        document.getElementById('song-author').innerHTML = audioAuthor;
        document.getElementById('audio').load();
    
        let progress = document.getElementById("progress");
        let song = document.getElementById("audio");
        let ctrlIcon = document.getElementById("ctrlIcon");
    
        song.onloadedmetadata = function(){
            progress.max = song.duration;
            progress.value = song.currentTime;
        }
    
        if(song.play()){
            setInterval(()=>{
                progress.value = song.currentTime;
            },200);
        }

        song.onended = function() {
            ctrlIcon.classList.remove("fa-pause");
            ctrlIcon.classList.add("fa-play");
        };

        function playPause(){
            if(ctrlIcon.classList.contains("fa-pause")){
                song.pause();
                ctrlIcon.classList.remove("fa-pause");
                ctrlIcon.classList.add("fa-play");
            }
            else{
                song.play();
                ctrlIcon.classList.remove("fa-play");
                ctrlIcon.classList.add("fa-pause");
            }
        }

        function skip(seconds) {
            song.currentTime += seconds;
        }
        
        progress.onchange = function(){
            song.play();
            song.currentTime = progress.value;
            ctrlIcon.classList.remove("fa-play");
            ctrlIcon.classList.add("fa-pause");
        }

        // Shuffle song functionality
        async function shuffleSong() {
            try {
                const response = await fetch('https://musicbank.vercel.app/list.json');
                const songList = await response.json();
                const randomIndex = Math.floor(Math.random() * songList.length);
                const randomSongPage = songList[randomIndex]; // Assuming this contains the song page name

                // Fetch the song details from the selected page
                const songResponse = await fetch(`https://musicbank.vercel.app/${randomSongPage}`);
                const songDetails = await songResponse.json();

                // Update the audio source, name, and author
                document.getElementById('audio-source').src = songDetails.Link;
                document.getElementById('song-name').innerHTML = songDetails.Name;
                document.getElementById('song-author').innerHTML = songDetails.Author;
                document.getElementById('audio').load();
                song.play(); // Automatically play the new song

                // Update the progress bar max value
                progress.max = song.duration; // Use song duration if available
            } catch (error) {
                console.error('Error fetching song data:', error);
            }
        }
    
    </script>
</body>
</html>
